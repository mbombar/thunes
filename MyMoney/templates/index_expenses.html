{% extends "base.html" %}

{% load bootstrap4 %}
{% load static %}
{% load mathfilters %}




{% block title %}Historique des dépenses de {{ group }} {% endblock %}

{% block content %}

<style type="text/css">
  .table-nostriped tbody tr:nth-of-type(odd) {
      background-color:transparent;
  }

  div.scrollable {
      word-wrap: break-word;
      max-width: 160px;
      max-height: 160px;
      margin: 0;
      padding: 0;
      overflow: auto;
  }
</style>


<h2>Historique des dépenses de {{group}}</h2>

<a href="{% url "MyMoney:balance" gid %}"> {% bootstrap_button "Retour au groupe" button_type="link" %} </a>

<nav>
  <ul class="pagination justify-content-center">

  {% if page_obj.has_previous %}
  <li class="page-item">
    <a class="page-link" href="?page=1">
      <span>&laquo;</span>
    </a>
  </li>
  <li class="page-item">
    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
      <span>&lsaquo;</span>
    </a>
  </li>
  {% endif %}

  {% for page in page_obj.paginator.page_range %}
  {% if page_obj.number <= page|add:3 and page_obj.number >= page|add:-3 %}
    <li class="page-item {% if page_obj.number == page %}active{% endif %}">
      <a class="page-link" href="?page={{ page }}">
	{{ page }}
      </a>
    </li>
  {% endif %}
  {% endfor %}

    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}">
	<span>&rsaquo;</span>
      </a>
    </li>
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">
	<span>&raquo;</span>
      </a>
    </li>

    {% endif %}
  </ul>
</nav>

<div class="table-responsive">
  <table class="table table-striped">
    <thead>
    <tr>
      <th>Date</th>
      <th class="text-center">Nom</th>
      <th>Emetteur</th>
      <th>Description</th>
      <th>Valeur</th>
      <th class="text-center">Parts</th>
    </tr>
    </thead>
    <tbody>
    {% for expense, total in page_obj %}
    <tr>
      <td class="text-nowrap">{{ expense.date }}</td>
      <td><div class="scrollable">{{ expense.name }}</div></td>
      <td>{{ expense.origin }}</td>
      <td><div class="scrollable">{{ expense.description }}</div></td>
      <td class="text-nowrap">{{ expense.value }} {{ expense.currency.symbol }}</td>
      <td class="text-nowrap">
	<div class="table-responsive">
	  <table class="table-borderless table-nostriped">
	    <tbody>
	      {% for share in expense.share_set.all %}
	      <tr>
		{% if share.value != 0 %}
		<td>{{ share.owner }}</td>
		<td class="text-nowrap">
		  {{ expense.value | mul:share.value|div:total | floatformat:2}}
		  {{ expense.currency.symbol }}
		</td>
		<td>{{ share.value }}</td>
		{% endif %}
		{% endfor %}
	      </tr>
	    </tbody>
	  </table>
	</div>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<nav>
  <ul class="pagination justify-content-center">

  {% if page_obj.has_previous %}
  <li class="page-item">
    <a class="page-link" href="?page=1">
      <span>&laquo;</span>
    </a>
  </li>
  <li class="page-item">
    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
      <span>&lsaquo;</span>
    </a>
  </li>
  {% endif %}

  {% for page in page_obj.paginator.page_range %}
  {% if page_obj.number <= page|add:3 and page_obj.number >= page|add:-3 %}
    <li class="page-item {% if page_obj.number == page %}active{% endif %}">
      <a class="page-link" href="?page={{ page }}">
	{{ page }}
      </a>
    </li>
  {% endif %}
  {% endfor %}

    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}">
	<span>&rsaquo;</span>
      </a>
    </li>
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">
	<span>&raquo;</span>
      </a>
    </li>

    {% endif %}
  </ul>
</nav>

{% endblock %}
